{"ast":null,"code":"import _objectSpread from\"/workspaces/claimpto/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\n * License Enforcement Service - Frontend\n * \n * SECURITY: This service provides license validation for the admin frontend.\n * It gates access to the admin dashboard and handles license status display.\n * \n * NOTE: Frontend validation is advisory only. Server-side enforcement is authoritative.\n * However, the frontend MUST check license status before rendering admin UI.\n */import axios from'axios';// License state\nlet licenseState={checked:false,valid:false,offline:false,graceExpiry:null,message:null,error:null,lastCheck:null};// Cache configuration\nconst CACHE_TTL_MS=60*1000;// 1 minute cache\n/**\n * Check if cached license state is still valid\n */function isCacheValid(){if(!licenseState.checked||!licenseState.lastCheck){return false;}const cacheAge=Date.now()-licenseState.lastCheck;return cacheAge<CACHE_TTL_MS;}/**\n * Validate license with the server\n * \n * This performs a fresh validation and should be called:\n * 1. On admin dashboard mount\n * 2. On admin login success\n * 3. Periodically during admin session\n * \n * @param {boolean} forceRefresh - Force server validation even if cache is valid\n * @returns {Promise<{valid: boolean, offline?: boolean, message?: string, error?: string}>}\n */export async function validateLicense(){let forceRefresh=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;// Use cache if valid and not forcing refresh\nif(!forceRefresh&&isCacheValid()&&licenseState.valid){return{valid:licenseState.valid,offline:licenseState.offline,message:licenseState.message,cached:true};}try{const token=localStorage.getItem('adminToken');if(!token){return{valid:false,error:'NOT_AUTHENTICATED',message:'Admin authentication required'};}const response=await axios.post('/license/validate',{},{headers:{'Authorization':\"Bearer \".concat(token)},timeout:15000});const result=response.data;// Update state\nlicenseState={checked:true,valid:result.valid===true,offline:result.offline||false,graceExpiry:result.graceExpiry||null,message:result.message||null,error:result.error||null,lastCheck:Date.now()};return{valid:licenseState.valid,offline:licenseState.offline,graceRemaining:result.graceRemaining,message:licenseState.message,error:licenseState.error};}catch(error){console.error('[LICENSE] Validation failed:',error.message);// Handle specific error responses\nif(error.response){const status=error.response.status;const data=error.response.data||{};// License explicitly invalid\nif(status===403){licenseState={checked:true,valid:false,offline:false,graceExpiry:null,message:data.message||'License validation failed',error:data.error||'LICENSE_INVALID',lastCheck:Date.now()};return{valid:false,error:data.error||'LICENSE_INVALID',message:data.message||'License validation failed'};}// Rate limited\nif(status===429){return{valid:false,error:'RATE_LIMITED',message:'Too many attempts. Please wait.'};}// Unauthorized\nif(status===401){return{valid:false,error:'UNAUTHORIZED',message:'Authentication expired'};}}// Network error - use cached state if available\nif(!error.response&&licenseState.checked&&licenseState.valid){console.log('[LICENSE] Using cached state due to network error');return{valid:licenseState.valid,offline:true,message:'Operating in offline mode (cached)',cached:true};}// Default failure\nreturn{valid:false,error:'VALIDATION_ERROR',message:error.message||'Unable to validate license'};}}/**\n * Get license status (quick check, no validation)\n * \n * @returns {Promise<{valid: boolean, offline?: boolean, message?: string}>}\n */export async function getLicenseStatus(){try{const token=localStorage.getItem('adminToken');if(!token){return{valid:false,message:'Not authenticated'};}const response=await axios.get('/license/status',{headers:{'Authorization':\"Bearer \".concat(token)},timeout:10000});return response.data;}catch(error){console.error('[LICENSE] Status check failed:',error.message);// Return cached state if available\nif(licenseState.checked){return{valid:licenseState.valid,offline:licenseState.offline,message:licenseState.message};}return{valid:false,error:'STATUS_ERROR',message:'Unable to check license status'};}}/**\n * Check if license is currently valid (synchronous, from cache)\n * \n * @returns {boolean}\n */export function isLicenseValid(){return licenseState.checked&&licenseState.valid;}/**\n * Get current license state\n * \n * @returns {object}\n */export function getLicenseState(){return _objectSpread({},licenseState);}/**\n * Clear license cache (call on logout)\n */export function clearLicenseCache(){licenseState={checked:false,valid:false,offline:false,graceExpiry:null,message:null,error:null,lastCheck:null};}/**\n * License Error Component\n * \n * Display component for license failures\n */export const LicenseError={INVALID:{icon:'üö´',title:'License Invalid',message:'Your license is invalid or has been revoked. Please contact support.'},EXPIRED:{icon:'‚è∞',title:'License Expired',message:'Your license has expired. Please renew to continue using the admin panel.'},DOMAIN_MISMATCH:{icon:'üåê',title:'Domain Mismatch',message:'This license is not valid for this domain.'},OFFLINE_EXPIRED:{icon:'üì°',title:'Offline Mode Expired',message:'The offline grace period has expired. Internet connection required.'},VALIDATION_ERROR:{icon:'‚ö†Ô∏è',title:'Validation Error',message:'Unable to validate your license. Please try again.'}};const licenseService={validateLicense,getLicenseStatus,isLicenseValid,getLicenseState,clearLicenseCache,LicenseError};export default licenseService;","map":{"version":3,"names":["axios","licenseState","checked","valid","offline","graceExpiry","message","error","lastCheck","CACHE_TTL_MS","isCacheValid","cacheAge","Date","now","validateLicense","forceRefresh","arguments","length","undefined","cached","token","localStorage","getItem","response","post","headers","concat","timeout","result","data","graceRemaining","console","status","log","getLicenseStatus","get","isLicenseValid","getLicenseState","_objectSpread","clearLicenseCache","LicenseError","INVALID","icon","title","EXPIRED","DOMAIN_MISMATCH","OFFLINE_EXPIRED","VALIDATION_ERROR","licenseService"],"sources":["/workspaces/claimpto/frontend/src/services/licenseService.js"],"sourcesContent":["/**\n * License Enforcement Service - Frontend\n * \n * SECURITY: This service provides license validation for the admin frontend.\n * It gates access to the admin dashboard and handles license status display.\n * \n * NOTE: Frontend validation is advisory only. Server-side enforcement is authoritative.\n * However, the frontend MUST check license status before rendering admin UI.\n */\n\nimport axios from 'axios';\n\n// License state\nlet licenseState = {\n  checked: false,\n  valid: false,\n  offline: false,\n  graceExpiry: null,\n  message: null,\n  error: null,\n  lastCheck: null\n};\n\n// Cache configuration\nconst CACHE_TTL_MS = 60 * 1000; // 1 minute cache\n\n/**\n * Check if cached license state is still valid\n */\nfunction isCacheValid() {\n  if (!licenseState.checked || !licenseState.lastCheck) {\n    return false;\n  }\n  \n  const cacheAge = Date.now() - licenseState.lastCheck;\n  return cacheAge < CACHE_TTL_MS;\n}\n\n/**\n * Validate license with the server\n * \n * This performs a fresh validation and should be called:\n * 1. On admin dashboard mount\n * 2. On admin login success\n * 3. Periodically during admin session\n * \n * @param {boolean} forceRefresh - Force server validation even if cache is valid\n * @returns {Promise<{valid: boolean, offline?: boolean, message?: string, error?: string}>}\n */\nexport async function validateLicense(forceRefresh = false) {\n  // Use cache if valid and not forcing refresh\n  if (!forceRefresh && isCacheValid() && licenseState.valid) {\n    return {\n      valid: licenseState.valid,\n      offline: licenseState.offline,\n      message: licenseState.message,\n      cached: true\n    };\n  }\n  \n  try {\n    const token = localStorage.getItem('adminToken');\n    if (!token) {\n      return {\n        valid: false,\n        error: 'NOT_AUTHENTICATED',\n        message: 'Admin authentication required'\n      };\n    }\n    \n    const response = await axios.post('/license/validate', {}, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      },\n      timeout: 15000\n    });\n    \n    const result = response.data;\n    \n    // Update state\n    licenseState = {\n      checked: true,\n      valid: result.valid === true,\n      offline: result.offline || false,\n      graceExpiry: result.graceExpiry || null,\n      message: result.message || null,\n      error: result.error || null,\n      lastCheck: Date.now()\n    };\n    \n    return {\n      valid: licenseState.valid,\n      offline: licenseState.offline,\n      graceRemaining: result.graceRemaining,\n      message: licenseState.message,\n      error: licenseState.error\n    };\n    \n  } catch (error) {\n    console.error('[LICENSE] Validation failed:', error.message);\n    \n    // Handle specific error responses\n    if (error.response) {\n      const status = error.response.status;\n      const data = error.response.data || {};\n      \n      // License explicitly invalid\n      if (status === 403) {\n        licenseState = {\n          checked: true,\n          valid: false,\n          offline: false,\n          graceExpiry: null,\n          message: data.message || 'License validation failed',\n          error: data.error || 'LICENSE_INVALID',\n          lastCheck: Date.now()\n        };\n        \n        return {\n          valid: false,\n          error: data.error || 'LICENSE_INVALID',\n          message: data.message || 'License validation failed'\n        };\n      }\n      \n      // Rate limited\n      if (status === 429) {\n        return {\n          valid: false,\n          error: 'RATE_LIMITED',\n          message: 'Too many attempts. Please wait.'\n        };\n      }\n      \n      // Unauthorized\n      if (status === 401) {\n        return {\n          valid: false,\n          error: 'UNAUTHORIZED',\n          message: 'Authentication expired'\n        };\n      }\n    }\n    \n    // Network error - use cached state if available\n    if (!error.response && licenseState.checked && licenseState.valid) {\n      console.log('[LICENSE] Using cached state due to network error');\n      return {\n        valid: licenseState.valid,\n        offline: true,\n        message: 'Operating in offline mode (cached)',\n        cached: true\n      };\n    }\n    \n    // Default failure\n    return {\n      valid: false,\n      error: 'VALIDATION_ERROR',\n      message: error.message || 'Unable to validate license'\n    };\n  }\n}\n\n/**\n * Get license status (quick check, no validation)\n * \n * @returns {Promise<{valid: boolean, offline?: boolean, message?: string}>}\n */\nexport async function getLicenseStatus() {\n  try {\n    const token = localStorage.getItem('adminToken');\n    if (!token) {\n      return { valid: false, message: 'Not authenticated' };\n    }\n    \n    const response = await axios.get('/license/status', {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      },\n      timeout: 10000\n    });\n    \n    return response.data;\n    \n  } catch (error) {\n    console.error('[LICENSE] Status check failed:', error.message);\n    \n    // Return cached state if available\n    if (licenseState.checked) {\n      return {\n        valid: licenseState.valid,\n        offline: licenseState.offline,\n        message: licenseState.message\n      };\n    }\n    \n    return {\n      valid: false,\n      error: 'STATUS_ERROR',\n      message: 'Unable to check license status'\n    };\n  }\n}\n\n/**\n * Check if license is currently valid (synchronous, from cache)\n * \n * @returns {boolean}\n */\nexport function isLicenseValid() {\n  return licenseState.checked && licenseState.valid;\n}\n\n/**\n * Get current license state\n * \n * @returns {object}\n */\nexport function getLicenseState() {\n  return { ...licenseState };\n}\n\n/**\n * Clear license cache (call on logout)\n */\nexport function clearLicenseCache() {\n  licenseState = {\n    checked: false,\n    valid: false,\n    offline: false,\n    graceExpiry: null,\n    message: null,\n    error: null,\n    lastCheck: null\n  };\n}\n\n/**\n * License Error Component\n * \n * Display component for license failures\n */\nexport const LicenseError = {\n  INVALID: {\n    icon: 'üö´',\n    title: 'License Invalid',\n    message: 'Your license is invalid or has been revoked. Please contact support.'\n  },\n  EXPIRED: {\n    icon: '‚è∞',\n    title: 'License Expired',\n    message: 'Your license has expired. Please renew to continue using the admin panel.'\n  },\n  DOMAIN_MISMATCH: {\n    icon: 'üåê',\n    title: 'Domain Mismatch',\n    message: 'This license is not valid for this domain.'\n  },\n  OFFLINE_EXPIRED: {\n    icon: 'üì°',\n    title: 'Offline Mode Expired',\n    message: 'The offline grace period has expired. Internet connection required.'\n  },\n  VALIDATION_ERROR: {\n    icon: '‚ö†Ô∏è',\n    title: 'Validation Error',\n    message: 'Unable to validate your license. Please try again.'\n  }\n};\n\nconst licenseService = {\n  validateLicense,\n  getLicenseStatus,\n  isLicenseValid,\n  getLicenseState,\n  clearLicenseCache,\n  LicenseError\n};\n\nexport default licenseService;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}